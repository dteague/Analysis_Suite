
  <!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Full Run-Through | Analysis Suite  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/theme.9297a650d9dd3016d913.css" />
    <link rel="stylesheet" href="_static/style.css" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="index" title="Index" href="genindex.html" />
  </head>

  <body class="antialiased text-gray scroll-smooth">
    <div
      id="page"
      data-controller="sidebar search "
      data-action="keydown@window->search#focus "
      class="min-h-screen xl:h-screen flex flex-col xl:grid xl:grid-layout print:block print:h-auto"
    >
      <a class="block transition -translate-x-full focus:translate-x-0 opacity-0 focus:opacity-100 text-xl bg-white p-4 z-20 absolute top-0 left-0 h-14" href="#full-run-through" title="Skip navigation links">Skip to content</a>

      <header class="grid-area-header z-10 h-14 fixed w-full top-0 print:hidden">
        <div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
      <button
    data-action="sidebar#open"
    data-sidebar-target="hamburger"
    class="xl:hidden h-14 w-14 leading-14 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand">
  <span class="sr-only">Open navigation menu</span>
  <svg aria-hidden="true" class="fill-current h-8 w-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</button><a class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none"
   href="index.html"
   title="Back to homepage"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 tracking-wider">Analysis Suite  documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form
  id="searchbox"
  action="search.html"
  data-action="click->search#focusSearchInput"
  method="get"
  class="flex print:hidden justify-between items-center leading-14 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static z-10">

  <button
    class="text-inherit h-14 w-14"
    aria-label="Get search results"
    tabindex="-1"
  >
    <svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
  </button>

  <input
    name="q"
    id="search-input"
    data-search-target="searchInput"
    type="search"
    aria-label="Search the docs"
    placeholder="Search the docs"
    class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100"
  />
</form></div>
</div>
      </header>

      
<aside data-sidebar-target="sidebar" class="grid-area-sidebar h-full fixed pt-14 xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100">
  <nav
  role="navigation"
  class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col"
>
  <div class="nav-toc flex-1 pl-6"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Main Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Basic running</a><ul>
<li class="toctree-l2"><a class="reference internal" href="running.html#analysis-analyze">Analysis (<code class="docutils literal notranslate"><span class="pre">analyze</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#bdt-runner-mva">BDT runner (<code class="docutils literal notranslate"><span class="pre">mva</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#plotting-plot">Plotting (<code class="docutils literal notranslate"><span class="pre">plot</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="running.html#setup-combine-combine">Setup Combine (<code class="docutils literal notranslate"><span class="pre">combine</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="analysis_suite.html">Analysis Suite Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="analysis_suite.commons.html"><code class="docutils literal notranslate"><span class="pre">commons</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.commons.html#commons-awkward-commons"><code class="docutils literal notranslate"><span class="pre">commons.awkward_commons</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.commons.html#module-analysis_suite.commons.configs"><code class="docutils literal notranslate"><span class="pre">commons.configs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.commons.html#commons-histogram"><code class="docutils literal notranslate"><span class="pre">commons.histogram</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.commons.html#module-analysis_suite.commons.info"><code class="docutils literal notranslate"><span class="pre">commons.info</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.commons.html#module-analysis_suite.commons.makeSimpleHtml"><code class="docutils literal notranslate"><span class="pre">commons.makeSimpleHtml</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis_suite.BDT_utilities.html"><code class="docutils literal notranslate"><span class="pre">BDT_utilities</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.BDT_utilities.html#bdt-utilities-mvaplotter"><code class="docutils literal notranslate"><span class="pre">BDT_utilities.MVAPlotter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.BDT_utilities.html#bdt-utilities-mvamaker"><code class="docutils literal notranslate"><span class="pre">BDT_utilities.MvaMaker</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis_suite.Plotting.html"><code class="docutils literal notranslate"><span class="pre">Plotting</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.Plotting.html#plotting-logfile"><code class="docutils literal notranslate"><span class="pre">Plotting.LogFile</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.Plotting.html#plotting-confighelper"><code class="docutils literal notranslate"><span class="pre">Plotting.configHelper</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.Plotting.html#plotting-pypad"><code class="docutils literal notranslate"><span class="pre">Plotting.pyPad</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_suite.Plotting.html#plotting-stack"><code class="docutils literal notranslate"><span class="pre">Plotting.stack</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

  <button
      data-action="sidebar#close"
      title="Close navigation menu"
      class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center">
    <span class="sr-only">Close navigation menu</span>
    <svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
  </button>
</nav>
</aside>

<main
  class="px-4 pt-14 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col flex-1 h-full mx-0 md:mx-auto xl:mr-0"
><nav role="navigation"
     aria-label="breadcrumbs"
     class="print:hidden mt-12 text-sm text-gray-light">
  <a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="index.html">Analysis Suite  documentation</a>
  <span class="mr-1">/</span><span aria-current="page">Full Run-Through</span>
</nav>
  <article role="main" class="flex-1">
    
  <section id="full-run-through">
<h1>Full Run-Through<a class="headerlink" href="#full-run-through" title="Permalink to this heading">¶</a></h1>
<p>In this section, we give an example set of code used for the 3top analysis. These are the commands that are used to go from NanoAOD files to a result from combine. This set of instructions tries to be as thorough as possible and will be tested periodically to ensure it should work on all setups.</p>
<p>Currently, the code base is only useable on the wisconsin cluster, but efforts to expand to using on other machines, namely lxplus are on the way. The only thing needed at the Wisconsin cluster is a way to submit jobs and a place to store the output. Wisconsin has a script called “farmoutAnalysis” which submits the jobs to condor and writes the output to a hadoop area. These files are hadd’ed and stored on the hdfs area for running. To genericize the code, this step is what needs to be fixed</p>
<p>Each code section does a distinct part of the analysis needed in whole, but each is done such that one can run each section individually. This is also done for 2018, but easily expanded to 2016pre, 2016post, 2017.</p>
<section id="initial-job-creation">
<h2>Initial Job Creation<a class="headerlink" href="#initial-job-creation" title="Permalink to this heading">¶</a></h2>
</section>
<section id="make-nonprompt-fake-rates">
<h2>Make Nonprompt Fake Rates<a class="headerlink" href="#make-nonprompt-fake-rates" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>voms-proxy-init -rfc -valid <span class="m">144</span>:00 -voms cms -bits <span class="m">2048</span>
<span class="c1"># Create lists of samples to run over</span>
create_lists.py -y <span class="m">2018</span> -t mc -r output -g ttbar,DY,wjets,qcd -f nonprompt_measurement
create_lists.py -y <span class="m">2018</span> -t data -r output -g MM,E -f nonprompt_measurement
create_lists.py -y <span class="m">2018</span> -t mc -r output -g ttbar_lep,wjet_ht -f nonprompt_closure
create_lists.py -y <span class="m">2018</span> -t data -r output -g MM,EM,EE -f nonprompt_closure
<span class="c1"># Submit the jobs</span>
farmoutJob.py -f nonprompt_measurement -y <span class="m">2018</span> -a FakeRate
farmoutJob.py -f nonprompt_closure -y <span class="m">2018</span> -a Nonprompt_Closure
<span class="c1"># After jobs are finished (monitor with condor_q)</span>
hadd.py -f nonprompt_measurement -y <span class="m">2018</span> -a FakeRate -d run_through
hadd.py -f nonprompt_closure -y <span class="m">2018</span> -a Nonprompt_Closure -d run_through
<span class="c1"># creates and moves files to directory in /hdfs/store/user/&lt;user&gt;/workspace/charge_misId/2018/run_through</span>
calculate_fr.py -y <span class="m">2018</span> -i run_through -r sideband,measurement,closure -d run_through
<span class="c1"># Run after make both fake rates for charge_misId and Nonprompt</span>
convert_fakerates.py -y <span class="m">2018</span> --nonprompt run_through --charge run_through
</pre></div>
</div>
</section>
<section id="make-charge-misidentification-fake-rates">
<h2>Make Charge Misidentification Fake Rates<a class="headerlink" href="#make-charge-misidentification-fake-rates" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>voms-proxy-init -rfc -valid <span class="m">144</span>:00 -voms cms -bits <span class="m">2048</span>
<span class="c1"># Create lists of samples to run over</span>
create_lists.py -y <span class="m">2018</span> -t mc -r output -g dy,vv,ttbar_lep -f charge_misId
create_lists.py -y <span class="m">2018</span> -t data -r output -g MM,EM,EE -f charge_misId
<span class="c1"># Submit the jobs</span>
farmoutJob.py -f charge_misId -y <span class="m">2018</span> -a Closure_MisId
<span class="c1"># After jobs are finished (monitor with condor_q)</span>
hadd.py -f charge_misId -y <span class="m">2018</span> -a Closure_MisId -d run_through
<span class="c1"># creates and moves files to directory in /hdfs/store/user/&lt;user&gt;/workspace/charge_misId/2018/run_through</span>
calculate_misId.py -y <span class="m">2018</span> -i run_through -r measurement,closure -d run_through
<span class="c1"># Run after make both fake rates for charge_misId and Nonprompt</span>
convert_fakerates.py -y <span class="m">2018</span> --nonprompt run_through --charge run_through
</pre></div>
</div>
<p>This snippet of code runs the basic btagging on signal like events and then calculates the MC btagging efficiencies for different flavor jets. This is used for getting the correct btagging scale factors. These scale factors are found as <code class="docutils literal notranslate"><span class="pre">data/POG/USER/&lt;year&gt;/beff.json.gz</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>voms-proxy-init -rfc -valid <span class="m">144</span>:00 -voms cms -bits <span class="m">2048</span>
create_lists.py -y <span class="m">2018</span> -t mc -r output -g ttt,tttt,ttX,ttXY,xg,vv,vvv,ttbar,dy,wjet,other -f befficiency
farmoutJob.py -f befficiency -y <span class="m">2018</span> -a BEfficiency -t mc
<span class="c1"># After jobs are finished (monitor with condor_q)</span>
hadd.py -f befficiency -y <span class="m">2018</span> -a BEfficiency -t mc -d run_through
<span class="c1"># creates and moves files to directory in /hdfs/store/user/&lt;user&gt;/workspace/befficiency/2018/run_through</span>
beff.py -y <span class="m">2018</span> -i run_through
</pre></div>
</div>
</section>
<section id="run-analysis-code-on-signal-region">
<h2>Run Analysis code on Signal Region<a class="headerlink" href="#run-analysis-code-on-signal-region" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>voms-proxy-init -rfc -valid <span class="m">144</span>:00 -voms cms -bits <span class="m">2048</span>
<span class="c1"># Create lists of samples to run over</span>
create_lists.py -y <span class="m">2018</span> -t mc -r output -g ttt,tttt,ttX,ttXY,xg,vv,vvv,ttbar,dy,wjet,other -f signal_region
create_lists.py -y <span class="m">2018</span> -t data -r output -g MM,EM,EE -f signal_region
<span class="c1"># Submit the jobs</span>
farmoutJob.py -f signal_region_ -y <span class="m">2018</span> -a ThreeTop
<span class="c1"># After jobs are finished (monitor with condor_q)</span>
hadd.py -f signal_region -y <span class="m">2018</span> -a ThreeTop -d run_through
</pre></div>
</div>
</section>
<section id="blah-blah">
<h2>blah blah<a class="headerlink" href="#blah-blah" title="Permalink to this heading">¶</a></h2>
<p>This section is about running over the ntuples created to the final combine results. The output of the main file is all stored in <code class="docutils literal notranslate"><span class="pre">workspace/&lt;workdir&gt;</span></code> where workdir is specified by the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option. The details are commented in the code block below</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creates a file per systematic called workspace/run_through/2018/processed_&lt;Syst&gt;.root</span>
<span class="c1">#   Create flattened files for signal region and TTZ control region</span>
./run_suite.py flatten -y <span class="m">2018</span> -d run_through -n signal -j <span class="m">4</span>
./run_suite.py flatten -y <span class="m">2018</span> -d run_through -n ttzCR -j <span class="m">4</span>
<span class="c1"># Train over nominal for Signal region (-t says to train)</span>
./run_suite.py mva -y <span class="m">2018</span> -d run_through -n signal -m XGBoost -t
<span class="c1"># Apply model trained for Signal and TTZ CR.</span>
<span class="c1">#   Creates files called workspace/run_through/2018/test_&lt;Syst&gt;.root</span>
./run_suite.py mva -y <span class="m">2018</span> -d run_through -n signal,ttzCR -m XGBoost
<span class="c1"># Creates histograms and datacards to be use by combine. Uses bjet as fitting variable</span>
./run_suite.py combine -y <span class="m">2018</span> -d run_through -sig bjet
<span class="c1"># Actual running of combine. combine.py is a wrapper for actual combine</span>
<span class="c1">#   Three tests below calculate the significance, asymptotic limit, and impact plots</span>
<span class="c1">#   These are stored in workspace/run_through/combine</span>
combine.py sig -y <span class="m">2018</span> -d run_through -f bjet --blind -n <span class="nb">test</span>
combine.py asymptotic -y <span class="m">2018</span> -d run_through -f bjet --blind -n <span class="nb">test</span>
combine.py impact -y <span class="m">2018</span> -d run_through -f bjet --blind -n <span class="nb">test</span>
</pre></div>
</div>
</section>
</section>


  </article>

  <footer>
    
      <div class="mt-20 mb-4 text-sm text-gray-700 print:mt-4">&copy; 2021, Dylan Teague&nbsp;Made with <a href="https://www.sphinx-doc.org">Sphinx 5.2.3</a></div>
    
  </footer></main>


      <button
  data-search-target="snackbar"
  data-action="search#hideSnackbar"
  class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full"
>
  Clear highlights
</button><div
  data-sidebar-target="screen"
  data-action="click->sidebar#close"
  class="fixed hidden inset-0 bg-black bg-opacity-50">
</div>
    </div>
    
      
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/sphinx_highlight.js"></script>
<script src="_static/theme.3051a0ec24cad00d4d88.js"></script>
    
  </body>
</html>